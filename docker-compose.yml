version: '3.9'

services:
    cache:
        image: redis:7.0-alpine
        restart: unless-stopped
        ports:
            - '2100:6379'
        command: redis-server --save 20 1 --loglevel warning
        volumes:
            - cache:/data
    app:
        build: ./
        pull_policy: build
        restart: unless-stopped
        ports:
            - '2000:3000'
        env_file:
            - stack.env
        depends_on:
            - cache
        links:
            - cache

networks:
    default:
        external: true
        name: nginx

volumes:
    cache:
        driver: local
